<!DOCTYPE html>
<html lang=en>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Kaveh v0.3" />
<meta name="description" content="How Arch/Rostam packages and pacman work, and why rostam-packages exists">
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAFxAAABcQG7iuH0AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhVJREFUOI2FkU1IlHEQxn/z33fbJSIIDx0ioUChj0Mm7R7KNRc7SAUdyiDCDoqXCC9BeKpTHYRIyFMRBBWEUFCgh0rIbFM3lKAsSKJLEn2Z7Yfr7vvOdAjD6FXnNPA8/GaeGVilekZS7ReG9x9ZTnerAVSkLUC6ukaaq8N0b2K6tm12IRbJ+7FM3pfGQhCd7ExksgCXM+lNvgXbRfgW8e080P4fwIxzgnb7lAtYLA52v29039uyCmrBekzuOvEuQnAtdAPBvqR3vHkAcHsyOUggxwz6/6STaoQ4sfhP8oXQiB7A0NTOR3OVNRR9dSbulcGsAGBxjG4tFtLAdChgd837ppWO2PO88ThwCywapq/6BcOGxGyX4rJhuiw298YSVcWoNhUqUamok4q6M4G5kgI5dRRVbuR811wwV8j57lk+gLzKd28RoGs0iUqfc1wydQEic2f3Pj20dFrnk/S4mdzE6WsJJCniGv5GOFr3csBBB0ariwSjK2R6B2DiNqsj9c8NTtRnHwaqp0wjvcsCxFpN3ZaqwrqW7MGBzxLmuTqWqPI13m++dpSABeLMAfMlqn9Bx50Dj08uer0wwOnE+I/eTMMLdZEhD4ZLfjAvJntU3AxwZak3EgbY0JLcKM59UnN1anZ9Qdxw2WRrGRlcUD5sO1z/dap/ypbdwMOrr5hLgUyISEoCQYwZjNoIria3tvgRmAX4DdT85ywDHCURAAAAAElFTkSuQmCC">
<title>Getting deeper with RostamOS</title>
<style>
html{overflow-y:scroll;}body{background-color:#fafafa;color:#333;margin:0 auto;padding:1ex;max-width:100ex;font-family:sans-serif;line-height:1.6;}img{display:block;margin:0 auto;max-width:100%;height:auto;}.code-block{background-color:#f5f5f5;border:1px solid #d0d0d0;border-radius:4px;margin:1em 0;overflow:hidden;}.code-block pre{margin:0;padding:1em;overflow-x:auto;}.code-block code,pre{font-family:monospace;background-color:#f0f0f0;border:1px solid #ccc;border-radius:6px;padding:1em;margin:1em 0;font-size:1em;line-height:1.5;color:#222;white-space:pre-wrap;word-wrap:break-word;overflow-x:visible;}p code,li code,td code,blockquote code{display:inline;padding:2px 4px;border:1px solid #d0d0d0;background-color:#e8e8e8;border-radius:3px;}h1,h2,h3,h4,h5,h6,h7{line-height:1.2;margin-top:1.5em;margin-bottom:0.5em;}.heading-with-anchor{position:relative;}.heading-anchor{position:absolute;left:-1.5em;top:50%;transform:translateY(-50%);text-decoration:none;opacity:0;padding-right:0.5em;transition:opacity 0.2s ease;display:inline-flex;align-items:center;}.heading-anchor .octicon{fill:#ccc;display:block;}.heading-with-anchor:hover .heading-anchor{opacity:1;}.heading-anchor:hover .octicon{fill:#0066cc;}table{border-collapse:collapse;width:100%;margin:1em 0;table-layout:fixed;}table td,table th{border:1px solid #ccc;padding:8px 12px;text-align:center;vertical-align:center;}table tr:nth-child(even){background-color:#f9f9f9;}table td code,table th code{overflow-wrap:anywhere;word-break:break-all;white-space:normal;}blockquote{border-left:4px solid #d0d0d0;margin:1em 0;padding-left:1em;color:#555;}hr{border:none;border-top:2px solid #ccc;margin:2em 0;}ul.task-list{list-style:none;padding-left:0;}ul.task-list li.task-list-item{padding-left:1.5em;}ul.task-list input[type="checkbox"]{margin-left:-1.5em;margin-right:0.5em;}mark{background-color:#ffff00;padding:2px 0;}del{text-decoration:line-through;opacity:0.7;}sub,sup{font-size:0.75em;line-height:0;position:relative;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}.footnotes{margin-top:2em;padding-top:1em;border-top:1px solid #ccc;font-size:0.9em;}.footnotes ol{padding-left:1.5em;}dl{margin:1em 0;}dt{font-weight:bold;margin-top:0.5em;}dd{margin-left:2em;margin-bottom:0.5em;}a{color:#0066cc;text-decoration:none;}a:hover{text-decoration:underline;color:#0052a3;}a:visited{color:#6b46c1;}ul ul,ol ol,ul ol,ol ul{margin:0.5em 0;}textarea,input,button{font-family:inherit;font-size:1em;border:1px solid #d0d0d0;border-radius:4px;padding:0.5em;}textarea,input[type="text"],input[type="password"],input[type="email"]{width:100%;background-color:#fff;color:#333;box-sizing:border-box;margin:0.5em 0;}textarea{resize:vertical;min-height:4em;}button{background-color:#0066cc;color:#fff;border:none;cursor:pointer;padding:0.6em 1.2em;margin:0.5em 0.5em 0.5em 0;transition:background-color 0.2s ease;}button:hover{background-color:#0052a3;}button:active{background-color:#003d7a;}.post-list{margin:2em 0;padding:1.5em;background-color:#f9f9f9;border:1px solid #e5e5e5;border-radius:6px;}.post-entry{margin-bottom:2em;padding-bottom:1.5em;border-bottom:1px solid #e0e0e0;}.post-entry:last-of-type{border-bottom:none;}.post-entry h3{margin-top:0;margin-bottom:0.5em;}.post-entry h3 a{color:#333;}.post-entry h3 a:hover{color:#0066cc;}.post-entry time{display:block;color:#666;font-size:0.9em;margin-bottom:0.5em;}.post-entry p{margin:0.5em 0 0 0;color:#555;}.post-entry .file-icon{display:inline-block;vertical-align:middle;margin-right:0.25em;fill:#666;}.pagination{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;margin:2em 0 0 0;padding:1em 0 0 0;border-top:2px solid #d0d0d0;}.pagination .prev{grid-column:1;justify-self:start;}.pagination .page-info{grid-column:2;text-align:center;color:#666;font-size:0.9em;}.pagination .next{grid-column:3;justify-self:end;}.pagination a{padding:0.5em 1em;background-color:#0066cc;color:#fff;border-radius:4px;text-decoration:none;}.pagination a:hover{background-color:#0052a3;}@media print{body{max-width:none;}}@media (prefers-color-scheme:dark){body{color:#e0e0e0;background-color:#1a1a1a;}.code-block{background-color:#0d0d0d;border-color:#333;}.code-block pre{color:#e0e0e0;}pre{background-color:#1e1e1e;border-color:#333;color:#f2f2f2;white-space:pre-wrap;word-wrap:break-word;overflow-x:visible;}p code,li code,td code,blockquote code{background-color:#0d0d0d;border-color:#333;color:#e0e0e0;}table td,table th{border-color:#444;}table tr:nth-child(even){background-color:#111;}blockquote{border-left-color:#444;color:#aaa;}hr{border-top-color:#444;}mark{background-color:#666600;color:#fff;}a:link{color:#cdf;}a:hover,a:visited:hover{color:#def;}a:visited{color:#dcf;}.footnotes{border-top-color:#444;}.heading-anchor .octicon{fill:#555;}.heading-anchor:hover .octicon{fill:#cdf;}textarea,input[type="text"],input[type="password"],input[type="email"]{background-color:#0d0d0d;color:#e0e0e0;border-color:#444;}button{background-color:#0066cc;}button:hover{background-color:#3388dd;}button:active{background-color:#0052a3;}.post-list{background-color:#0d0d0d;border-color:#333;}.post-entry{border-bottom-color:#333;}.post-entry h3 a{color:#e0e0e0;}.post-entry h3 a:hover{color:#cdf;}.post-entry time{color:#999;}.post-entry p{color:#aaa;}.pagination{border-top-color:#444;}.pagination a{background-color:#0066cc;}.pagination a:hover{background-color:#3388dd;}.pagination .page-info{color:#999;}.post-entry .file-icon{fill:#999;}}
</style>
</head>
<body>
<div>
<header><h1 id="home" class="heading-with-anchor"><a href="/"><- Home</a><a href="#home" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1></header>
<p>This post explains, at a high level, how Arch-style packages work, how pacman consumes repositories, and why I maintain both a binary mirror and a source repo for “Rostam‑exclusive” packages.
</p>
<p>Links for reference:</p>
<ul>
<li>Binary mirror and automation: https://github.com/RostamOS/packages
</li>
<li>Rostam source PKGBUILDs: https://github.com/RostamOS/rostam-packages
</li></ul>
<h2 id="arch-packaging-model-in-brief" class="heading-with-anchor">Arch packaging model in brief<a href="#arch-packaging-model-in-brief" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul>
<li>PKGBUILD: a shell recipe describing how to fetch sources, apply patches, build, and package.
</li>
<li>makepkg: builds the package from a PKGBUILD, producing a .pkg.tar.zst (and optionally a .sig).
</li>
<li>repo-add/repo-remove: update the repository database files (e.g., repo.db, repo.files) to index available packages.
</li>
<li>Repository layout: typically per-arch subtree (e.g., x86_64/) containing packages and the repo database.
</li></ul>
<div class="code-block"><pre>
+------------------+     makepkg      +---------------------+
|   PKGBUILD (+)   | ---------------&gt; | .pkg.tar.zst (+sig) |
|  sources/patches |                   +---------------------+
       |                                         |
       v                                  repo-add -&gt; repo.db/.files
+------------------+        publish        +---------------------------+
|   build chroot   | --------------------&gt; |  static repo (x86_64/)   |
+------------------+                       +---------------------------+
</pre></div>
<h2 id="how-pacman-consumes-repos" class="heading-with-anchor">How pacman consumes repos<a href="#how-pacman-consumes-repos" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p>pacman uses libalpm to sync repository databases and resolve transactions.
</p>
<ul>
<li>Configuration: /etc/pacman.conf lists repositories in priority order.
</li>
<li>Sync: pacman -Sy fetches repo.db(.tar*), optionally repo.files, and signatures if enabled.
</li>
<li>Resolve: pacman computes a transaction (add/remove/upgrade) with dependency solving and conflicts.
</li>
<li>Acquire: packages are downloaded (HTTP), signatures verified (if configured), and then extracted to the filesystem.
</li></ul>
<div class="code-block"><pre>
$ pacman -S foo
   |
   v
[mirrorlist] -&gt; fetch repo.db[.sig]
   |
resolve dependencies -&gt; build transaction
   |
download .pkg.tar.zst[.sig] -&gt; verify -&gt; extract to /
</pre></div>
<p>A minimal repository config (example; check the packages repo for the current URL):</p>
<div class="code-block"><pre>
# /etc/pacman.conf
[rostam]
SigLevel = Optional TrustAll
Server = &lt;rostam_repo_url&gt;/$arch
</pre></div>
<h2 id="why-rostam-packages-exist" class="heading-with-anchor">Why Rostam packages exist<a href="#why-rostam-packages-exist" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul>
<li>Velocity: prebuilt binaries remove local compile time for common and personal packages.
</li>
<li>Reproducibility: pinned PKGBUILD versions/patches yield predictable builds.
</li>
<li>Curation: slim defaults and opinionated variants aligned with my environment.
</li>
<li>Independence: external projects I rely on (and my own tools) are available even if AUR recipes drift.
</li></ul>
<h2 id="rostamos-repositories" class="heading-with-anchor">RostamOS repositories<a href="#rostamos-repositories" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul>
<li>Binary mirror automation - RostamOS/packages
<ul>
<li>Scripts/CI periodically rebuild a set of packages (including selected AUR) and run repo-add.
</li>
<li>Artifacts are published in an x86_64/ directory with repo.db/.files for pacman.
</li></ul>
</li>
<li>Rostam‑exclusive sources - RostamOS/rostam-packages
<ul>
<li>PKGBUILDs for my forks/patchsets and packages not present in official repos.
</li>
<li>Built by the same pipeline to land in the binary mirror.
</li></ul>
</li></ul>
<h3 id="build-pipeline-overview" class="heading-with-anchor">Build pipeline overview<a href="#build-pipeline-overview" class="heading-anchor" aria-label="Permalink"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<div class="code-block"><pre>
RostamOS/rostam-packages (PKGBUILDs)
            |
            v
       makepkg in clean environment
            |
            v
 .pkg.tar.zst (+ .sig)  -- repo-add --&gt;  repo.db / repo.files
            |                               |
            +----------- publish -----------+
</pre></div>
<p>For details and the current setup, see the READMEs in the two repositories linked above.</p>
<footer><table>
<tr><td><p style="text-align: center;"><a href="https://github.com/MahdiMirzadeh">Github</a><p></td><td><p style="text-align: center;"><a href="https://x.com/MahdiMirzade">X</a><p></td><td><p style="text-align: center;"><a href="https://t.me/MahdiMirzade">Telegram</a><p></td><td><p style="text-align: center;"><a href="https://www.youtube.com/@MahdiMirzade">Youtube</a><p></td><td><p style="text-align: center;"><a href="/blog.xml">RSS</a><p></td></tr>
</table>
<p style="text-align: center"><small>Generated by <a href="https://github.com/MahdiMirzadeh/Kaveh">Kaveh</a></small></p></footer>
</div>
</body>
</html>
